target_default: 10_get_data

packages:
  - dataRetrieval
  - yaml
  - EGRET
  - dplyr
  
sources:
  - 10_get_data/code/get_daily_data_nwis.R
  - 10_get_data/code/precip_fxns.R
  
targets:
  10_get_data:
    depends:
      - discharge
      - discharge_info
      - tp
      - tp_daily
      - tp_info
      - ortho_p_filt
      - ortho_p_filt_info
      - ortho_p_unfilt
      - diss_p
      - ss
      - ss_info
      - msn_precip
      - 10_get_data/out/msn_precip.csv

  config:
    command: yaml.load_file('10_get_data/config/dataRetrieval_config.yml')
      
  site_no:
    command: config[['site_no']]
      
  pcodes:
    command: config[['pcodes']]
      
  start_date:
    command: config[['start_date']]
      
  end_date:
    command: config[['end_date']]
      
  discharge:
    command: readNWISDaily(siteNumber = site_no, startDate = start_date, endDate = end_date)
    
  discharge_info:
    command: readNWISInfo(siteNumber = site_no, parameterCd = I('00060'))
     
  tp:
    command: readNWISSample(siteNumber = site_no, parameterCd = I('00665'), startDate = start_date, endDate = end_date)
   
  tp_daily_wy1997:
    command: read.csv('10_get_data/raw/Yahara_daily_conc_WY1997.csv', skip = I(2), stringsAsFactors = FALSE)
  
  tp_daily:
    command: get_daily_p(start = start_date, end = end_date, site = site_no, pcode = I('00665'), tp_samples = tp, tp_1997 = tp_daily_wy1997)
    
  tp_info:
    command: readNWISInfo(siteNumber = site_no, parameterCd = I('00665'))
    
  ortho_p_filt:
    command: readNWISSample(siteNumber = site_no, parameterCd = I('00671'), startDate = start_date, endDate = end_date)
    
  ortho_p_filt_info:
    command: readNWISInfo(siteNumber = site_no, parameterCd = I('00671'))
    
  ortho_p_unfilt:
    command: readNWISSample(siteNumber = site_no, parameterCd = I('70507'), startDate = start_date, endDate = end_date)
    
  diss_p:
    command: readNWISSample(siteNumber = site_no, parameterCd = I('00666'), startDate = start_date, endDate = end_date)
    
  ss:
    command: readNWISSample(siteNumber = site_no, parameterCd = I('80154'), startDate = start_date, endDate = end_date)
    
  ss_info:
    command: readNWISInfo(site_no, I('80154'))
    
  msn_precip:
    command: get_precip(file_loc = '10_get_data/raw/msn_weather_record.csv')
    
  10_get_data/out/msn_precip.csv:
    command: write.csv(msn_precip, target_name, row.names = FALSE)
    